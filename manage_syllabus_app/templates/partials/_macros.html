
{% macro editable_field(object, field_name, model_name, syllabus_object, input_type='input', data_rest_url=None) %}
<div id="editable-container-{{ model_name }}-{{ object.id }}-{{ field_name }}" class="editable-container">

    <div class="display-view mt-5">
        <p class="mb-0" style="white-space: pre-wrap;">{{ object[field_name] or "Chưa có nội dung"}}</p>
        <button type="button" class="btn btn-outline-primary btn-sm ms-3 flex-shrink-0 edit-trigger-button"
                onclick="toggleFieldEdit('{{ model_name }}-{{ object.id }}-{{ field_name }}', true)">
            <i class="fas fa-pencil-alt"></i> Chỉnh sửa
        </button>
    </div>

    <div class="edit-view" style="display: none;">
        {#
           Kiểm tra xem data_rest_url có được truyền vào không.
           - Nếu CÓ: Dùng 'rest-form' mới và phương thức 'PATCH'.
           - Nếu KHÔNG: Dùng 'ajax-form' cũ và action '/update_generic_field'.
        #}
        <form
              class="{{ 'rest-form' if data_rest_url else 'ajax-form' }}"
              data-method="{{ 'PATCH' if data_rest_url else 'POST' }}"
              data-url="{{ data_rest_url }}"
              action='#' >

            {# Các trường ẩn này vẫn cần thiết để JavaScript (cả cũ và mới) có thể hoạt động #}
            <input type="hidden" name="model_name" value="{{ model_name }}">
            <input type="hidden" name="object_id" value="{{ object.id }}">
            <input type="hidden" name="syllabus_id" value="{{ syllabus_object.id }}">

            {% if input_type == 'textarea' %}
            <textarea class="form-control input-style" name="{{ field_name }}" rows="3">{{ object[field_name] }}</textarea>
            {% else %}
            <input type="text" class="form-control input-style" name="{{ field_name }}" value="{{ object[field_name] }}">
            {% endif %}

            <div class="text-end mt-2">
                <button type="button" class="btn btn-secondary btn-sm"
                        onclick="toggleFieldEdit('{{ model_name }}-{{ object.id }}-{{ field_name }}', false)">Hủy
                </button>
                <button type="submit" class="btn btn-success btn-sm">Lưu</button>
            </div>
        </form>
    </div>
</div>
{% endmacro %}